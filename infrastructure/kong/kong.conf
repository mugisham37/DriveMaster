# Kong Configuration File
# Production-ready configuration for Adaptive Learning Platform

# Database settings
database = postgres
pg_host = kong-database
pg_port = 5432
pg_user = kong
pg_password = kong_password
pg_database = kong

# Network settings
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl
admin_listen = 0.0.0.0:8001
admin_gui_listen = 0.0.0.0:8002

# SSL/TLS settings
ssl_cert = /etc/kong/ssl/kong.crt
ssl_cert_key = /etc/kong/ssl/kong.key
ssl_protocols = TLSv1.2 TLSv1.3
ssl_ciphers = ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305

# Security headers
headers = Server, X-Kong-Response-Latency
trusted_ips = 0.0.0.0/0,::/0

# Performance settings
worker_processes = auto
worker_connections = 1024
upstream_keepalive_pool_size = 60
upstream_keepalive_max_requests = 100
upstream_keepalive_idle_timeout = 60s

# Logging
log_level = info
proxy_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# Plugins
plugins = bundled,jwt,rate-limiting,request-transformer,response-transformer,prometheus,opentelemetry,cors,request-size-limiting

# Rate limiting
rate_limiting_policy = redis
rate_limiting_redis_host = redis-cluster
rate_limiting_redis_port = 6379
rate_limiting_redis_database = 1

# Caching
proxy_cache_path = /tmp/kong_cache
proxy_cache = on

# Health checks
health_checks_active_healthy_interval = 5
health_checks_active_unhealthy_interval = 5
health_checks_passive_healthy_counter = 3
health_checks_passive_unhealthy_counter = 3

# Request/Response limits
client_max_body_size = 10m
client_body_buffer_size = 8k